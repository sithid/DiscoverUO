@page "/dashboard"
@using DiscoverUO.Lib.Shared
@using DiscoverUO.Lib.Shared.Favorites
@using DiscoverUO.Lib.Shared.Servers
@using DiscoverUO.Lib.Shared.Users
@using DiscoverUO.Web.Components.Data
@using System.Net.Http.Headers
@inject NavigationManager navManager
@inject HttpClient client

<PageTitle>Dashboard</PageTitle>

<MudContainer>
    <MudPaper>
        <MudItem xs="12" Class="mt-4 pa-4 mud-theme-secondary">
            <MudCard>
                <MudCardHeader>
                    <MudText Typo="Typo.h1">Welcome Back, @UserSession.UserProfile.UserDisplayName</MudText>
                    @if (showAvatar)
                    {
                        <MudCardMedia Image="@UserSession.UserProfile.UserAvatar" />
                    }
                </MudCardHeader>
                <MudCardContent>
                    <MudText Align="Align.Center" Typo="Typo.h5">User Email: @UserSession.Email</MudText>
                    <MudText Align="Align.Center" Typo="Typo.h5">User Creation Date: @UserSession.CreationDate</MudText>
                    <MudText Align="Align.Center" Typo="Typo.h5">User Remaining Votes : @UserSession.DailyVotesRemaining</MudText>
                </MudCardContent>
                <MudCardContent>
                    <MudText Align="Align.Center" Typo="Typo.h5">User Biography:</MudText>
                    <MudText Align="Align.Center" Typo="Typo.h5">@UserSession.UserProfile.UserBiography</MudText>
                </MudCardContent>
                <MudCardActions>
                    <MudSpacer />
                    <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@FavoritesOnClick">Favorites</MudButton>
                    <MudSpacer/>
                    <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@MyServersOnClick">My Servers</MudButton>
                    <MudSpacer />
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudPaper>
    <MudImage Src="@UserSession.UserProfile.UserAvatar" /> 
</MudContainer>

@code
{
    [CascadingParameter]
    public SessionManager UserSession { get; set; }

    private bool showAvatar;

    protected async override Task OnInitializedAsync()
    {
        if (UserSession == null)
            navManager.NavigateTo("/singin");

        if (UserSession.UserProfile == null || string.IsNullOrEmpty(UserSession.UserProfile.UserAvatar))
        {
            showAvatar = false;
            StateHasChanged();
        }
    }

    private void FavoritesOnClick()
    {
        navManager.NavigateTo("/myfavorites");
    }

    private void MyServersOnClick()
    {
        navManager.NavigateTo("/myservers");
    }
}