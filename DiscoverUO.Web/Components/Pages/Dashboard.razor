@using DiscoverUO.Lib.Shared
@using System.Net.Http.Headers
@using DiscoverUO.Lib.Shared.Favorites
@using DiscoverUO.Lib.Shared.Servers
@using DiscoverUO.Lib.Shared.Users

@inject HttpClient client
@inject ISnackbar snackbar
@inject NavigationManager navManager


@page "/dashboard"

<PageTitle>Dashboard</PageTitle>

<MudContainer>
    @if (!UserSession.UserAuthenticated)
    {
        snackbar.Add("You must be signed in to view your dashboard.  Redirecting you to sign in.", Severity.Warning);
        navManager.NavigateTo("/signin");
    }
    else
    {
        <MudPaper>
            <MudItem xs="12" Class="mt-4 pa-4 mud-theme-primary">
                <MudCard>
                    <MudCardHeader>
                        <MudText Typo="Typo.h1">Welcome Back, @UserSession.UserProfile.UserDisplayName</MudText>
                        @if (showAvatar)
                        {
                            <MudCardMedia Image="@UserSession.UserProfile.UserAvatar" />
                        }
                    </MudCardHeader>
                    <MudCardContent>
                        <MudText Align="Align.Center" Typo="Typo.h5">User Email: @UserSession.Email</MudText>
                        <MudText Align="Align.Center" Typo="Typo.h5">User Creation Date: @UserSession.CreationDate</MudText>
                        <MudText Align="Align.Center" Typo="Typo.h5">User Remaining Votes : @UserSession.DailyVotesRemaining</MudText>
                    </MudCardContent>
                    <MudCardContent>
                        <MudText Align="Align.Center" Typo="Typo.h5">User Biography:</MudText>
                        <MudText Align="Align.Center" Typo="Typo.h5">@UserSession.UserProfile.UserBiography</MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <MudSpacer />
                        <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@FavoritesOnClick">Favorites</MudButton>
                        <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@MyServersOnClick">My Servers</MudButton>
                        <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@EditProfileOnClick">Edit Profile</MudButton>
                        <MudSpacer />
                    </MudCardActions>
                </MudCard>
            </MudItem>
        </MudPaper>
    }
</MudContainer>

@code
{
    [CascadingParameter]
    public SessionManager UserSession { get; set; }

    private bool showAvatar;

    protected async override Task OnInitializedAsync()
    {
        if (UserSession == null)
            navManager.NavigateTo("/singin");

        UserSession.GetUserProfileData(client);
    }

    private void EditProfileOnClick()
    {
        navManager.NavigateTo("/users/update");
    }

    private void FavoritesOnClick()
    {
        navManager.NavigateTo("/favorites/myfavorites");
    }

    private void MyServersOnClick()
    {
        navManager.NavigateTo("/servers/myservers");
    }
}